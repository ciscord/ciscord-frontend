{"ast":null,"code":"var _jsxFileName = \"/Volumes/MacData/work/ciscord-frontend.git/components/Chat/Message/Message.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect, useContext, forwardRef } from 'react';\nimport { UserContext } from 'context/UserContext';\nimport { useInView } from 'react-intersection-observer';\nimport { transformMessage } from 'utils/helper';\nimport Actions from './Actions';\nimport Reactions from './Reactions';\nimport Replies from './Replies';\nimport Editor from './Editor';\nimport MessageWrapper from './_MessageWrapper';\nimport * as S from './Message.styled';\nconst Message = forwardRef(({\n  message,\n  isChild,\n  onEdit,\n  onThreadOpen,\n  isThread,\n  noActions,\n  className,\n  unread,\n  onEntryInView,\n  isPreview,\n  isFirstMessage\n}, forwardedRef) => {\n  const {\n    user,\n    getMessageQueue\n  } = useContext(UserContext);\n  const {\n    0: isEditing,\n    1: setEditing\n  } = useState(false);\n  const {\n    0: showActions,\n    1: setShowActions\n  } = useState(false);\n  const toggleEditing = () => setEditing(!isEditing);\n  const editMessage = editedValue => {\n    if (message.body !== editedValue) {\n      onEdit(editedValue, message.id);\n    }\n    toggleEditing();\n  };\n  const [intersectionRef, inView] = useInView({\n    triggerOnce: true,\n    threshold: 0\n  });\n  useEffect(() => {\n    if (unread && inView) {\n      onEntryInView(message);\n    }\n  }, [inView]);\n  const setShow = value => {\n    setShowActions(value);\n  };\n  const showReactions = !isEditing && message.reactions && message.reactions.length > 0;\n  const showReplies = !isThread && !isPreview && message.children.length > 0;\n  const canShowAction = !noActions && !isEditing && user;\n  let isDeleted = false;\n  if (user) {\n    const deletedMessages = getMessageQueue();\n    if (deletedMessages.filter(e => e === message.id).length > 0) isDeleted = true;\n  }\n  return __jsx(S.MessageContainer, {\n    show: canShowAction && showActions,\n    onMouseLeave: () => setShowActions(false),\n    onMouseEnter: () => setShowActions(true),\n    onMouseOver: () => setShowActions(true),\n    onFocus: () => setShowActions(true),\n    editing: isEditing,\n    unread: unread,\n    className: className || '',\n    ref: forwardedRef,\n    isFirstMessage: isFirstMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }\n  }, __jsx(MessageWrapper, {\n    message: message,\n    isEditing: isEditing,\n    isChild: isChild,\n    isDeleted: isDeleted,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 9\n    }\n  }, isEditing ? __jsx(Editor, {\n    initialValue: transformMessage(message.body),\n    onCancel: toggleEditing,\n    onSubmit: editMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }\n  }) : __jsx(S.Body, {\n    child: isChild,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 13\n    }\n  }, transformMessage(message.body)), showReactions && __jsx(Reactions, {\n    reactions: message.reactions,\n    messageId: message.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 29\n    }\n  }), showReplies && __jsx(Replies, {\n    reply: message.children,\n    onClick: () => onThreadOpen(message.id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }\n  })), canShowAction && showActions && __jsx(Actions, {\n    setShow: setShow,\n    isThread: isThread,\n    onEdit: toggleEditing,\n    onReply: () => onThreadOpen(message.id),\n    message: message,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 11\n    }\n  }), __jsx(\"div\", {\n    ref: intersectionRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 9\n    }\n  }));\n});\nexport default Message;","map":{"version":3,"names":["useState","useEffect","useContext","forwardRef","UserContext","useInView","transformMessage","Actions","Reactions","Replies","Editor","MessageWrapper","S","Message","message","isChild","onEdit","onThreadOpen","isThread","noActions","className","unread","onEntryInView","isPreview","isFirstMessage","forwardedRef","user","getMessageQueue","isEditing","setEditing","showActions","setShowActions","toggleEditing","editMessage","editedValue","body","id","intersectionRef","inView","triggerOnce","threshold","setShow","value","showReactions","reactions","length","showReplies","children","canShowAction","isDeleted","deletedMessages","filter","e"],"sources":["/Volumes/MacData/work/ciscord-frontend.git/components/Chat/Message/Message.js"],"sourcesContent":["import { useState, useEffect, useContext, forwardRef } from 'react';\nimport { UserContext } from 'context/UserContext';\nimport { useInView } from 'react-intersection-observer';\nimport { transformMessage } from 'utils/helper';\n\nimport Actions from './Actions';\nimport Reactions from './Reactions';\nimport Replies from './Replies';\nimport Editor from './Editor';\n\nimport MessageWrapper from './_MessageWrapper';\n\nimport * as S from './Message.styled';\n\nconst Message = forwardRef(\n  (\n    {\n      message,\n      isChild,\n      onEdit,\n      onThreadOpen,\n      isThread,\n      noActions,\n      className,\n      unread,\n      onEntryInView,\n      isPreview,\n      isFirstMessage,\n    },\n    forwardedRef\n  ) => {\n    const { user, getMessageQueue } = useContext(UserContext);\n    const [isEditing, setEditing] = useState(false);\n    const [showActions, setShowActions] = useState(false);\n\n    const toggleEditing = () => setEditing(!isEditing);\n\n    const editMessage = editedValue => {\n      if (message.body !== editedValue) {\n        onEdit(editedValue, message.id);\n      }\n      toggleEditing();\n    };\n\n    const [intersectionRef, inView] = useInView({\n      triggerOnce: true,\n      threshold: 0,\n    });\n\n    useEffect(() => {\n      if (unread && inView) {\n        onEntryInView(message);\n      }\n    }, [inView]);\n\n    const setShow = value => {\n      setShowActions(value);\n    };\n\n    const showReactions = !isEditing && message.reactions && message.reactions.length > 0;\n    const showReplies = !isThread && !isPreview && message.children.length > 0;\n\n    const canShowAction = !noActions && !isEditing && user;\n    let isDeleted = false;\n    if (user) {\n      const deletedMessages = getMessageQueue();\n      if (deletedMessages.filter(e => e === message.id).length > 0) isDeleted = true;\n    }\n    return (\n      <S.MessageContainer\n        show={canShowAction && showActions}\n        onMouseLeave={() => setShowActions(false)}\n        onMouseEnter={() => setShowActions(true)}\n        onMouseOver={() => setShowActions(true)}\n        onFocus={() => setShowActions(true)}\n        editing={isEditing}\n        unread={unread}\n        className={className || ''}\n        ref={forwardedRef}\n        isFirstMessage={isFirstMessage}\n      >\n        <MessageWrapper\n          message={message}\n          isEditing={isEditing}\n          isChild={isChild}\n          isDeleted={isDeleted}\n        >\n          {isEditing ? (\n            <Editor\n              initialValue={transformMessage(message.body)}\n              onCancel={toggleEditing}\n              onSubmit={editMessage}\n            />\n          ) : (\n            <S.Body child={isChild}>{transformMessage(message.body)}</S.Body>\n          )}\n          {showReactions && <Reactions reactions={message.reactions} messageId={message.id} />}\n          {showReplies && (\n            <Replies reply={message.children} onClick={() => onThreadOpen(message.id)} />\n          )}\n        </MessageWrapper>\n        {canShowAction && showActions && (\n          <Actions\n            setShow={setShow}\n            isThread={isThread}\n            onEdit={toggleEditing}\n            onReply={() => onThreadOpen(message.id)}\n            message={message}\n          />\n        )}\n        <div ref={intersectionRef} />\n      </S.MessageContainer>\n    );\n  }\n);\n\nexport default Message;\n"],"mappings":";;;AAAA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,UAAU,EAAEC,UAAU,QAAQ,OAAO;AACnE,SAASC,WAAW,QAAQ,qBAAqB;AACjD,SAASC,SAAS,QAAQ,6BAA6B;AACvD,SAASC,gBAAgB,QAAQ,cAAc;AAE/C,OAAOC,OAAO,MAAM,WAAW;AAC/B,OAAOC,SAAS,MAAM,aAAa;AACnC,OAAOC,OAAO,MAAM,WAAW;AAC/B,OAAOC,MAAM,MAAM,UAAU;AAE7B,OAAOC,cAAc,MAAM,mBAAmB;AAE9C,OAAO,KAAKC,CAAC,MAAM,kBAAkB;AAErC,MAAMC,OAAO,GAAGV,UAAU,CACxB,CACE;EACEW,OAAO;EACPC,OAAO;EACPC,MAAM;EACNC,YAAY;EACZC,QAAQ;EACRC,SAAS;EACTC,SAAS;EACTC,MAAM;EACNC,aAAa;EACbC,SAAS;EACTC;AACF,CAAC,EACDC,YAAY,KACT;EACH,MAAM;IAAEC,IAAI;IAAEC;EAAgB,CAAC,GAAGzB,UAAU,CAACE,WAAW,CAAC;EACzD,MAAM;IAAA,GAACwB,SAAS;IAAA,GAAEC;EAAU,IAAI7B,QAAQ,CAAC,KAAK,CAAC;EAC/C,MAAM;IAAA,GAAC8B,WAAW;IAAA,GAAEC;EAAc,IAAI/B,QAAQ,CAAC,KAAK,CAAC;EAErD,MAAMgC,aAAa,GAAG,MAAMH,UAAU,CAAC,CAACD,SAAS,CAAC;EAElD,MAAMK,WAAW,GAAGC,WAAW,IAAI;IACjC,IAAIpB,OAAO,CAACqB,IAAI,KAAKD,WAAW,EAAE;MAChClB,MAAM,CAACkB,WAAW,EAAEpB,OAAO,CAACsB,EAAE,CAAC;IACjC;IACAJ,aAAa,EAAE;EACjB,CAAC;EAED,MAAM,CAACK,eAAe,EAAEC,MAAM,CAAC,GAAGjC,SAAS,CAAC;IAC1CkC,WAAW,EAAE,IAAI;IACjBC,SAAS,EAAE;EACb,CAAC,CAAC;EAEFvC,SAAS,CAAC,MAAM;IACd,IAAIoB,MAAM,IAAIiB,MAAM,EAAE;MACpBhB,aAAa,CAACR,OAAO,CAAC;IACxB;EACF,CAAC,EAAE,CAACwB,MAAM,CAAC,CAAC;EAEZ,MAAMG,OAAO,GAAGC,KAAK,IAAI;IACvBX,cAAc,CAACW,KAAK,CAAC;EACvB,CAAC;EAED,MAAMC,aAAa,GAAG,CAACf,SAAS,IAAId,OAAO,CAAC8B,SAAS,IAAI9B,OAAO,CAAC8B,SAAS,CAACC,MAAM,GAAG,CAAC;EACrF,MAAMC,WAAW,GAAG,CAAC5B,QAAQ,IAAI,CAACK,SAAS,IAAIT,OAAO,CAACiC,QAAQ,CAACF,MAAM,GAAG,CAAC;EAE1E,MAAMG,aAAa,GAAG,CAAC7B,SAAS,IAAI,CAACS,SAAS,IAAIF,IAAI;EACtD,IAAIuB,SAAS,GAAG,KAAK;EACrB,IAAIvB,IAAI,EAAE;IACR,MAAMwB,eAAe,GAAGvB,eAAe,EAAE;IACzC,IAAIuB,eAAe,CAACC,MAAM,CAACC,CAAC,IAAIA,CAAC,KAAKtC,OAAO,CAACsB,EAAE,CAAC,CAACS,MAAM,GAAG,CAAC,EAAEI,SAAS,GAAG,IAAI;EAChF;EACA,OACE,MAAC,CAAC,CAAC,gBAAgB;IACjB,IAAI,EAAED,aAAa,IAAIlB,WAAY;IACnC,YAAY,EAAE,MAAMC,cAAc,CAAC,KAAK,CAAE;IAC1C,YAAY,EAAE,MAAMA,cAAc,CAAC,IAAI,CAAE;IACzC,WAAW,EAAE,MAAMA,cAAc,CAAC,IAAI,CAAE;IACxC,OAAO,EAAE,MAAMA,cAAc,CAAC,IAAI,CAAE;IACpC,OAAO,EAAEH,SAAU;IACnB,MAAM,EAAEP,MAAO;IACf,SAAS,EAAED,SAAS,IAAI,EAAG;IAC3B,GAAG,EAAEK,YAAa;IAClB,cAAc,EAAED,cAAe;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GAE/B,MAAC,cAAc;IACb,OAAO,EAAEV,OAAQ;IACjB,SAAS,EAAEc,SAAU;IACrB,OAAO,EAAEb,OAAQ;IACjB,SAAS,EAAEkC,SAAU;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GAEpBrB,SAAS,GACR,MAAC,MAAM;IACL,YAAY,EAAEtB,gBAAgB,CAACQ,OAAO,CAACqB,IAAI,CAAE;IAC7C,QAAQ,EAAEH,aAAc;IACxB,QAAQ,EAAEC,WAAY;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EACtB,GAEF,MAAC,CAAC,CAAC,IAAI;IAAC,KAAK,EAAElB,OAAQ;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GAAET,gBAAgB,CAACQ,OAAO,CAACqB,IAAI,CAAC,CACxD,EACAQ,aAAa,IAAI,MAAC,SAAS;IAAC,SAAS,EAAE7B,OAAO,CAAC8B,SAAU;IAAC,SAAS,EAAE9B,OAAO,CAACsB,EAAG;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAAG,EACnFU,WAAW,IACV,MAAC,OAAO;IAAC,KAAK,EAAEhC,OAAO,CAACiC,QAAS;IAAC,OAAO,EAAE,MAAM9B,YAAY,CAACH,OAAO,CAACsB,EAAE,CAAE;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAC3E,CACc,EAChBY,aAAa,IAAIlB,WAAW,IAC3B,MAAC,OAAO;IACN,OAAO,EAAEW,OAAQ;IACjB,QAAQ,EAAEvB,QAAS;IACnB,MAAM,EAAEc,aAAc;IACtB,OAAO,EAAE,MAAMf,YAAY,CAACH,OAAO,CAACsB,EAAE,CAAE;IACxC,OAAO,EAAEtB,OAAQ;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAEpB,EACD;IAAK,GAAG,EAAEuB,eAAgB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAAG,CACV;AAEzB,CAAC,CACF;AAED,eAAexB,OAAO"},"metadata":{},"sourceType":"module"}