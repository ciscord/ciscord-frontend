{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar _this = this,\n  _jsxFileName = \"/Volumes/MacData/work/ciscord-frontend.git/components/Channel/ChannelInfo/Members/Members.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : _Object$getOwnPropertyDescriptors ? _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { useLazyQuery } from '@apollo/client';\nimport { useEscapeToClose } from 'hooks';\nimport { COMPANY_NAME } from 'utils/config';\nimport { GET_COMMUNITY } from 'apis/Community';\nimport { USER_WENT_ONLINE, USER_WENT_OFFLINE } from 'apis/User';\nimport { UserIcon, CloseIcon } from 'components/UI/Icons';\nimport PortalWrapper from 'components/UI/PortalWrapper';\nimport Member from './Member';\nimport MembersPlaceholder from './Members.placeholder';\nimport * as S from './Members.styled';\nvar Members = function Members(_ref) {\n  var show = _ref.show,\n    onClose = _ref.onClose;\n  var _useRouter = useRouter(),\n    _useRouter$query = _useRouter.query,\n    communityUrl = _useRouter$query.community,\n    channelUrl = _useRouter$query.channel;\n  var _useLazyQuery = useLazyQuery(GET_COMMUNITY),\n    _useLazyQuery2 = _slicedToArray(_useLazyQuery, 2),\n    getMembers = _useLazyQuery2[0],\n    _useLazyQuery2$ = _useLazyQuery2[1],\n    data = _useLazyQuery2$.data,\n    loading = _useLazyQuery2$.loading,\n    error = _useLazyQuery2$.error,\n    subscribeToMore = _useLazyQuery2$.subscribeToMore;\n  useEscapeToClose(onClose);\n  useEffect(function () {\n    if (channelUrl) {\n      getMembers({\n        variables: {\n          url: communityUrl\n        }\n      });\n    }\n  }, [channelUrl]);\n  useEffect(function () {\n    if (subscribeToMore) {\n      subscribeToMore({\n        document: USER_WENT_ONLINE,\n        variables: {\n          channelUrl: \"\".concat(communityUrl, \"/\").concat(channelUrl),\n          tenant: COMPANY_NAME()\n        },\n        updateQuery: function updateQuery(prev, _ref2) {\n          var _prev$members, _prev$members$filter;\n          var subscriptionData = _ref2.subscriptionData;\n          if (!subscriptionData.data) return prev;\n          var user = subscriptionData.data.user;\n          var userData = (_prev$members = prev.members) === null || _prev$members === void 0 ? void 0 : (_prev$members$filter = _prev$members.filter(function (member) {\n            return member.username === user.username;\n          })) === null || _prev$members$filter === void 0 ? void 0 : _prev$members$filter[0];\n          if (userData) {\n            userData.isOnline = user === null || user === void 0 ? void 0 : user.isOnline;\n          }\n          return _objectSpread({}, prev);\n        }\n      });\n      subscribeToMore({\n        document: USER_WENT_OFFLINE,\n        variables: {\n          channelUrl: \"\".concat(communityUrl, \"/\").concat(channelUrl),\n          tenant: COMPANY_NAME()\n        },\n        updateQuery: function updateQuery(prev, _ref3) {\n          var _prev$members2, _prev$members2$filter;\n          var subscriptionData = _ref3.subscriptionData;\n          if (!subscriptionData.data) return prev;\n          var user = subscriptionData.data.user;\n          var userData = (_prev$members2 = prev.members) === null || _prev$members2 === void 0 ? void 0 : (_prev$members2$filter = _prev$members2.filter(function (member) {\n            return member.username === user.username;\n          })) === null || _prev$members2$filter === void 0 ? void 0 : _prev$members2$filter[0];\n          if (userData) {\n            userData.isOnline = user === null || user === void 0 ? void 0 : user.isOnline;\n          }\n          return _objectSpread({}, prev);\n        }\n      });\n    }\n  }, [subscribeToMore]);\n  if (error) {\n    return __jsx(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 12\n      }\n    });\n  }\n  if (loading || !data) {\n    return __jsx(MembersPlaceholder, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 12\n      }\n    });\n  }\n  return __jsx(PortalWrapper, {\n    show: show,\n    portalKey: \"members\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 5\n    }\n  }, __jsx(S.Wrapper, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, __jsx(S.Container, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }\n  }, __jsx(S.Header, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }\n  }, __jsx(S.Title, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 15\n    }\n  }, \"About this channel\"), __jsx(S.Subtitle, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 15\n    }\n  }, __jsx(S.UserIcon, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 17\n    }\n  }, __jsx(UserIcon, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 19\n    }\n  })), data.community && \" \".concat(data.community.members.length, \" members\"))), __jsx(CloseIcon, {\n    onClick: onClose,\n    style: {\n      position: 'inherit'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  })), __jsx(S.List, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 11\n    }\n  }, data.community && data.community.members.map(function (member) {\n    return __jsx(Member, {\n      member: member,\n      key: member.id,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 52\n      }\n    });\n  })))));\n};\nexport default Members;","map":{"version":3,"names":["useEffect","useRouter","useLazyQuery","useEscapeToClose","COMPANY_NAME","GET_COMMUNITY","USER_WENT_ONLINE","USER_WENT_OFFLINE","UserIcon","CloseIcon","PortalWrapper","Member","MembersPlaceholder","S","Members","show","onClose","query","communityUrl","community","channelUrl","channel","getMembers","data","loading","error","subscribeToMore","variables","url","document","tenant","updateQuery","prev","subscriptionData","user","userData","members","filter","member","username","isOnline","length","position","map","id"],"sources":["/Volumes/MacData/work/ciscord-frontend.git/components/Channel/ChannelInfo/Members/Members.js"],"sourcesContent":["import { useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { useLazyQuery } from '@apollo/client';\nimport { useEscapeToClose } from 'hooks';\nimport { COMPANY_NAME } from 'utils/config';\nimport { GET_COMMUNITY } from 'apis/Community';\nimport { USER_WENT_ONLINE, USER_WENT_OFFLINE } from 'apis/User';\nimport { UserIcon, CloseIcon } from 'components/UI/Icons';\nimport PortalWrapper from 'components/UI/PortalWrapper';\n\nimport Member from './Member';\nimport MembersPlaceholder from './Members.placeholder';\nimport * as S from './Members.styled';\n\nconst Members = ({ show, onClose }) => {\n  const {\n    query: { community: communityUrl, channel: channelUrl },\n  } = useRouter();\n  const [getMembers, { data, loading, error, subscribeToMore }] = useLazyQuery(GET_COMMUNITY);\n\n  useEscapeToClose(onClose);\n\n  useEffect(() => {\n    if (channelUrl) {\n      getMembers({ variables: { url: communityUrl } });\n    }\n  }, [channelUrl]);\n\n  useEffect(() => {\n    if (subscribeToMore) {\n      subscribeToMore({\n        document: USER_WENT_ONLINE,\n        variables: {\n          channelUrl: `${communityUrl}/${channelUrl}`,\n          tenant: COMPANY_NAME(),\n        },\n        updateQuery: (prev, { subscriptionData }) => {\n          if (!subscriptionData.data) return prev;\n          const { user } = subscriptionData.data;\n          const userData = prev.members?.filter(member => member.username === user.username)?.[0];\n          if (userData) {\n            userData.isOnline = user?.isOnline;\n          }\n\n          return {\n            ...prev,\n          };\n        },\n      });\n      subscribeToMore({\n        document: USER_WENT_OFFLINE,\n        variables: {\n          channelUrl: `${communityUrl}/${channelUrl}`,\n          tenant: COMPANY_NAME(),\n        },\n        updateQuery: (prev, { subscriptionData }) => {\n          if (!subscriptionData.data) return prev;\n          const { user } = subscriptionData.data;\n\n          const userData = prev.members?.filter(member => member.username === user.username)?.[0];\n          if (userData) {\n            userData.isOnline = user?.isOnline;\n          }\n\n          return {\n            ...prev,\n          };\n        },\n      });\n    }\n  }, [subscribeToMore]);\n\n  if (error) {\n    return <div />;\n  }\n  if (loading || !data) {\n    return <MembersPlaceholder />;\n  }\n\n  return (\n    <PortalWrapper show={show} portalKey=\"members\">\n      <S.Wrapper>\n        <S.Container>\n          <S.Header>\n            <div>\n              <S.Title>About this channel</S.Title>\n              <S.Subtitle>\n                <S.UserIcon>\n                  <UserIcon />\n                </S.UserIcon>\n                {data.community && ` ${data.community.members.length} members`}\n              </S.Subtitle>\n            </div>\n            <CloseIcon onClick={onClose} style={{ position: 'inherit' }} />\n          </S.Header>\n\n          <S.List>\n            {data.community &&\n              data.community.members.map(member => <Member member={member} key={member.id} />)}\n          </S.List>\n        </S.Container>\n      </S.Wrapper>\n    </PortalWrapper>\n  );\n};\n\nexport default Members;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}