{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : _Object$getOwnPropertyDescriptors ? _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport { useEffect, useContext, useState } from 'react';\nimport { UserContext } from 'context/UserContext';\nimport { useRouter } from 'next/router';\nimport { useQuery } from '@apollo/client';\nimport { useEscapeToClose } from 'hooks';\nimport { COMPANY_NAME } from 'utils/config';\nimport { GET_PRIVATE_CHANNELS } from 'apis/Channel';\nimport { NOTIFICATIONS_SUBSCRIPTION } from 'apis/Notification';\nimport PrivateChat from './PrivateChat';\nimport * as S from './styled';\nvar PrivateChats = function PrivateChats() {\n  var _useState = useState(false),\n    subscribed = _useState[0],\n    setSubscribed = _useState[1];\n  var router = useRouter();\n  useEscapeToClose(router.back);\n  var _useQuery = useQuery(GET_PRIVATE_CHANNELS, {\n      fetchPolicy: 'cache-and-network'\n    }),\n    _useQuery$data = _useQuery.data,\n    _useQuery$data2 = _useQuery$data === void 0 ? {} : _useQuery$data,\n    _useQuery$data2$priva = _useQuery$data2.privateChannels,\n    privateChannels = _useQuery$data2$priva === void 0 ? [] : _useQuery$data2$priva,\n    loading = _useQuery.loading,\n    refetch = _useQuery.refetch,\n    subscribeToMore = _useQuery.subscribeToMore;\n  var _useContext = useContext(UserContext),\n    user = _useContext.user;\n  useEffect(function () {\n    if (user && !subscribed) {\n      setSubscribed(true);\n      subscribeToMore({\n        document: NOTIFICATIONS_SUBSCRIPTION,\n        variables: {\n          receiverId: user.id,\n          tenant: COMPANY_NAME()\n        },\n        updateQuery: function updateQuery(prev, _ref) {\n          var subscriptionData = _ref.subscriptionData;\n          if (!subscriptionData.data) return prev;\n          var newNotification = subscriptionData.data.newNotification;\n          if (newNotification.type === 'direct' && prev.privateChannels.filter(function (channel) {\n            return channel.id === newNotification.channel.id;\n          }).length === 0) {\n            return _objectSpread({}, prev, {\n              privateChannels: [newNotification.channel].concat(_toConsumableArray(prev.privateChannels))\n            });\n          }\n          return prev;\n        }\n      });\n    }\n  }, [user, subscribeToMore]);\n  if (loading || !user) {\n    return __jsx(\"div\", null);\n  }\n  return __jsx(S.Wrapper, null, __jsx(\"div\", {\n    className: \"chat-base-header\",\n    onClick: function onClick() {\n      return refetch();\n    }\n  }, __jsx(\"h3\", {\n    className: \"chat-base-header__title\"\n  }, \"Private Chats\")), __jsx(\"div\", {\n    className: \"chat-latest-body\"\n  }, privateChannels && privateChannels.map(function (privateChannel) {\n    var channelUsernames = privateChannel.url.replace('direct/', '').split('-');\n    var otherUsername = channelUsernames.indexOf(user.username) === 0 ? channelUsernames[1] : channelUsernames[0];\n    return __jsx(PrivateChat, {\n      key: privateChannel.id,\n      username: otherUsername,\n      channel: privateChannel\n    });\n  })));\n};\nexport default PrivateChats;","map":{"version":3,"names":["useEffect","useContext","useState","UserContext","useRouter","useQuery","useEscapeToClose","COMPANY_NAME","GET_PRIVATE_CHANNELS","NOTIFICATIONS_SUBSCRIPTION","PrivateChat","S","PrivateChats","subscribed","setSubscribed","router","back","fetchPolicy","data","privateChannels","loading","refetch","subscribeToMore","user","document","variables","receiverId","id","tenant","updateQuery","prev","subscriptionData","newNotification","type","filter","channel","length","map","privateChannel","channelUsernames","url","replace","split","otherUsername","indexOf","username"],"sources":["/Volumes/MacData/work/ciscord-frontend.git/components/Channel/PrivateChats/PrivateChats.js"],"sourcesContent":["import { useEffect, useContext, useState } from 'react';\nimport { UserContext } from 'context/UserContext';\nimport { useRouter } from 'next/router';\nimport { useQuery } from '@apollo/client';\nimport { useEscapeToClose } from 'hooks';\nimport { COMPANY_NAME } from 'utils/config';\nimport { GET_PRIVATE_CHANNELS } from 'apis/Channel';\nimport { NOTIFICATIONS_SUBSCRIPTION } from 'apis/Notification';\nimport PrivateChat from './PrivateChat';\nimport * as S from './styled';\n\nconst PrivateChats = () => {\n  const [subscribed, setSubscribed] = useState(false);\n\n  const router = useRouter();\n  useEscapeToClose(router.back);\n\n  const { data: { privateChannels = [] } = {}, loading, refetch, subscribeToMore } = useQuery(\n    GET_PRIVATE_CHANNELS,\n    {\n      fetchPolicy: 'cache-and-network',\n    }\n  );\n\n  const { user } = useContext(UserContext);\n\n  useEffect(() => {\n    if (user && !subscribed) {\n      setSubscribed(true);\n      subscribeToMore({\n        document: NOTIFICATIONS_SUBSCRIPTION,\n        variables: { receiverId: user.id, tenant: COMPANY_NAME() },\n        updateQuery: (prev, { subscriptionData }) => {\n          if (!subscriptionData.data) return prev;\n          const { newNotification } = subscriptionData.data;\n\n          if (\n            newNotification.type === 'direct' &&\n            prev.privateChannels.filter(channel => channel.id === newNotification.channel.id)\n              .length === 0\n          ) {\n            return {\n              ...prev,\n              privateChannels: [newNotification.channel, ...prev.privateChannels],\n            };\n          }\n          return prev;\n        },\n      });\n    }\n  }, [user, subscribeToMore]);\n\n  if (loading || !user) {\n    return <div />;\n  }\n\n  return (\n    <S.Wrapper>\n      <div className=\"chat-base-header\" onClick={() => refetch()}>\n        <h3 className=\"chat-base-header__title\">Private Chats</h3>\n      </div>\n      <div className=\"chat-latest-body\">\n        {privateChannels &&\n          privateChannels.map(privateChannel => {\n            const channelUsernames = privateChannel.url.replace('direct/', '').split('-');\n            const otherUsername =\n              channelUsernames.indexOf(user.username) === 0\n                ? channelUsernames[1]\n                : channelUsernames[0];\n            return (\n              <PrivateChat\n                key={privateChannel.id}\n                username={otherUsername}\n                channel={privateChannel}\n              />\n            );\n          })}\n      </div>\n    </S.Wrapper>\n  );\n};\n\nexport default PrivateChats;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}