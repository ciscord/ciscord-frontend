{"ast":null,"code":"import _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useCallback, useState, useRef, useEffect } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { useMutation } from '@apollo/client';\nimport { EDIT_REPLY_MESSAGE } from 'apis/Message';\nimport { CloseIcon } from 'components/UI/Icons';\nimport DropzoneOverlay from 'components/UI/Dropzone';\nimport PortalWrapper from 'components/UI/PortalWrapper';\nimport Message from 'components/Chat/Message';\nimport ThreadInput from './ThreadInput';\nimport * as S from './styled';\nvar ThreadRightBar = function ThreadRightBar(_ref) {\n  var message = _ref.message,\n    onClose = _ref.onClose,\n    onCopyLink = _ref.onCopyLink,\n    scrollMessageId = _ref.scrollMessageId;\n  var scrollView = useRef(null);\n  var scrollMessage = useRef(null);\n  var _useMutation = useMutation(EDIT_REPLY_MESSAGE),\n    _useMutation2 = _slicedToArray(_useMutation, 1),\n    editReplyMessage = _useMutation2[0];\n  var _useState = useState([]),\n    attachments = _useState[0],\n    setAttachments = _useState[1];\n  var _useState2 = useState(true),\n    isNeedScroll = _useState2[0],\n    setScrollStatus = _useState2[1];\n  var onKeyDown = function onKeyDown(e) {\n    if (e.key === 'Escape') {\n      onClose();\n    }\n  };\n  useEffect(function () {\n    if (true) {\n      window.addEventListener('keydown', onKeyDown);\n      return function () {\n        window.removeEventListener('keydown', onKeyDown);\n      };\n    }\n    return window.removeEventListener('keydown', onKeyDown);\n  }, []);\n  useEffect(function () {\n    var threadChat = scrollView.current && scrollView.current._container;\n    if (threadChat) {\n      threadChat.scrollTop = threadChat.scrollHeight;\n    }\n  }, [message]);\n  var onDrop = useCallback(function (acceptedFiles) {\n    setAttachments(acceptedFiles);\n  }, []);\n  var _useDropzone = useDropzone({\n      onDrop: onDrop,\n      accept: 'image/*'\n    }),\n    getRootProps = _useDropzone.getRootProps,\n    getInputProps = _useDropzone.getInputProps,\n    isDragActive = _useDropzone.isDragActive;\n  var scrollToMessage = function scrollToMessage(messageRef) {\n    if (!messageRef.current) return;\n    scrollView.current.scrollTop = messageRef.current.offsetTop - 20;\n  };\n  useEffect(function () {\n    if (isNeedScroll && message) {\n      scrollToMessage(scrollMessage);\n      setScrollStatus(false);\n    }\n  }, [message]);\n  var handleEdit = function handleEdit(body, messageId) {\n    editReplyMessage({\n      variables: {\n        messageId: messageId,\n        body: body\n      }\n    });\n  };\n  var handleCopyLink = function handleCopyLink(_ref2) {\n    var id = _ref2.id;\n    onCopyLink({\n      id: id,\n      parentId: message.id\n    });\n  };\n  var eraseAttachments = function eraseAttachments() {\n    setAttachments([]);\n  };\n  return __jsx(PortalWrapper, {\n    show: message,\n    portalKey: \"thread\"\n  }, message && __jsx(S.Wrapper, getRootProps({\n    onClick: function onClick(e) {\n      return e.stopPropagation();\n    }\n  }), __jsx(S.Container, null, __jsx(S.Header, null, __jsx(\"div\", null, __jsx(S.Title, null, \"Thread\"), __jsx(S.Subtitle, null, \"#\".concat(message.author.username || message.author.name))), __jsx(CloseIcon, {\n    onClick: onClose,\n    style: {\n      position: 'initial'\n    }\n  })), __jsx(S.Content, {\n    ref: scrollView\n  }, __jsx(Message, {\n    message: message,\n    isThread: true,\n    noActions: true,\n    className: \"parent-message\"\n  }), __jsx(S.MessageList, null, message.children.map(function (child, index, list) {\n    var isDirectLink = scrollMessageId === child.id;\n    var previousMessage = list[index - 1];\n    var isChild = !!previousMessage && previousMessage.author.username === child.author.username;\n    return isDirectLink ? __jsx(Message, {\n      message: child,\n      className: \"message\",\n      isThread: true,\n      isChild: isChild,\n      onEdit: handleEdit,\n      key: child.id,\n      onCopyLink: handleCopyLink,\n      isDirectLink: isDirectLink,\n      ref: scrollMessage\n    }) : __jsx(Message, {\n      message: child,\n      className: \"message\",\n      isThread: true,\n      isChild: isChild,\n      onEdit: handleEdit,\n      key: child.id,\n      onCopyLink: handleCopyLink\n    });\n  })))), __jsx(\"input\", getInputProps()), __jsx(ThreadInput, {\n    messageId: message.id,\n    dropzoneItems: attachments,\n    eraseAttachments: eraseAttachments\n  }), isDragActive && __jsx(DropzoneOverlay, null)));\n};\nexport default ThreadRightBar;","map":{"version":3,"names":["useCallback","useState","useRef","useEffect","useDropzone","useMutation","EDIT_REPLY_MESSAGE","CloseIcon","DropzoneOverlay","PortalWrapper","Message","ThreadInput","S","ThreadRightBar","message","onClose","onCopyLink","scrollMessageId","scrollView","scrollMessage","editReplyMessage","attachments","setAttachments","isNeedScroll","setScrollStatus","onKeyDown","e","key","window","addEventListener","removeEventListener","threadChat","current","_container","scrollTop","scrollHeight","onDrop","acceptedFiles","accept","getRootProps","getInputProps","isDragActive","scrollToMessage","messageRef","offsetTop","handleEdit","body","messageId","variables","handleCopyLink","id","parentId","eraseAttachments","onClick","stopPropagation","author","username","name","position","children","map","child","index","list","isDirectLink","previousMessage","isChild"],"sources":["/Volumes/MacData/work/ciscord-frontend.git/components/Chat/Thread/index.js"],"sourcesContent":["import { useCallback, useState, useRef, useEffect } from 'react';\r\nimport { useDropzone } from 'react-dropzone';\r\nimport { useMutation } from '@apollo/client';\r\nimport { EDIT_REPLY_MESSAGE } from 'apis/Message';\r\nimport { CloseIcon } from 'components/UI/Icons';\r\n\r\nimport DropzoneOverlay from 'components/UI/Dropzone';\r\nimport PortalWrapper from 'components/UI/PortalWrapper';\r\nimport Message from 'components/Chat/Message';\r\nimport ThreadInput from './ThreadInput';\r\nimport * as S from './styled';\r\n\r\nconst ThreadRightBar = ({ message, onClose, onCopyLink, scrollMessageId }) => {\r\n  const scrollView = useRef(null);\r\n  const scrollMessage = useRef(null);\r\n  const [editReplyMessage] = useMutation(EDIT_REPLY_MESSAGE);\r\n\r\n  const [attachments, setAttachments] = useState([]);\r\n  const [isNeedScroll, setScrollStatus] = useState(true);\r\n\r\n  const onKeyDown = e => {\r\n    if (e.key === 'Escape') {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (process.browser) {\r\n      window.addEventListener('keydown', onKeyDown);\r\n      return () => {\r\n        window.removeEventListener('keydown', onKeyDown);\r\n      };\r\n    }\r\n    return window.removeEventListener('keydown', onKeyDown);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const threadChat = scrollView.current && scrollView.current._container;\r\n\r\n    if (threadChat) {\r\n      threadChat.scrollTop = threadChat.scrollHeight;\r\n    }\r\n  }, [message]);\r\n\r\n  const onDrop = useCallback(acceptedFiles => {\r\n    setAttachments(acceptedFiles);\r\n  }, []);\r\n\r\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\r\n    onDrop,\r\n    accept: 'image/*',\r\n  });\r\n\r\n  const scrollToMessage = messageRef => {\r\n    if (!messageRef.current) return;\r\n\r\n    scrollView.current.scrollTop = messageRef.current.offsetTop - 20;\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isNeedScroll && message) {\r\n      scrollToMessage(scrollMessage);\r\n      setScrollStatus(false);\r\n    }\r\n  }, [message]);\r\n\r\n  const handleEdit = (body, messageId) => {\r\n    editReplyMessage({\r\n      variables: {\r\n        messageId,\r\n        body,\r\n      },\r\n    });\r\n  };\r\n\r\n  const handleCopyLink = ({ id }) => {\r\n    onCopyLink({ id, parentId: message.id });\r\n  };\r\n\r\n  const eraseAttachments = () => {\r\n    setAttachments([]);\r\n  };\r\n\r\n  return (\r\n    <PortalWrapper show={message} portalKey=\"thread\">\r\n      {message && (\r\n        <S.Wrapper\r\n          {...getRootProps({\r\n            onClick: e => e.stopPropagation(),\r\n          })}\r\n        >\r\n          <S.Container>\r\n            <S.Header>\r\n              <div>\r\n                <S.Title>Thread</S.Title>\r\n                <S.Subtitle>{`#${message.author.username || message.author.name}`}</S.Subtitle>\r\n              </div>\r\n              <CloseIcon onClick={onClose} style={{ position: 'initial' }} />\r\n            </S.Header>\r\n            <S.Content ref={scrollView}>\r\n              <Message message={message} isThread noActions className=\"parent-message\" />\r\n              {/*\r\n              <S.ReplyNumber>\r\n                <span>{`${message.children.length} replies`}</span>\r\n              </S.ReplyNumber>\r\n              */}\r\n              <S.MessageList>\r\n                {message.children.map((child, index, list) => {\r\n                  const isDirectLink = scrollMessageId === child.id;\r\n                  const previousMessage = list[index - 1];\r\n                  const isChild =\r\n                    !!previousMessage && previousMessage.author.username === child.author.username;\r\n\r\n                  return isDirectLink ? (\r\n                    <Message\r\n                      message={child}\r\n                      className=\"message\"\r\n                      isThread\r\n                      isChild={isChild}\r\n                      onEdit={handleEdit}\r\n                      key={child.id}\r\n                      onCopyLink={handleCopyLink}\r\n                      isDirectLink={isDirectLink}\r\n                      ref={scrollMessage}\r\n                    />\r\n                  ) : (\r\n                    <Message\r\n                      message={child}\r\n                      className=\"message\"\r\n                      isThread\r\n                      isChild={isChild}\r\n                      onEdit={handleEdit}\r\n                      key={child.id}\r\n                      onCopyLink={handleCopyLink}\r\n                    />\r\n                  );\r\n                })}\r\n              </S.MessageList>\r\n            </S.Content>\r\n          </S.Container>\r\n          <input {...getInputProps()} />\r\n          <ThreadInput\r\n            messageId={message.id}\r\n            dropzoneItems={attachments}\r\n            eraseAttachments={eraseAttachments}\r\n          />\r\n          {isDragActive && <DropzoneOverlay />}\r\n        </S.Wrapper>\r\n      )}\r\n    </PortalWrapper>\r\n  );\r\n};\r\n\r\nexport default ThreadRightBar;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}