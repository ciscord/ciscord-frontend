{"ast":null,"code":"import _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar _this = this,\n  _jsxFileName = \"/Volumes/MacData/work/ciscord-frontend.git/components/Chat/Message/Message.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect, useContext, forwardRef } from 'react';\nimport { UserContext } from 'context/UserContext';\nimport { useInView } from 'react-intersection-observer';\nimport { transformMessage } from 'utils/helper';\nimport Actions from './Actions';\nimport Reactions from './Reactions';\nimport Replies from './Replies';\nimport Editor from './Editor';\nimport MessageWrapper from './_MessageWrapper';\nimport * as S from './Message.styled';\nvar Message = forwardRef(function (_ref, forwardedRef) {\n  var message = _ref.message,\n    isChild = _ref.isChild,\n    onEdit = _ref.onEdit,\n    onThreadOpen = _ref.onThreadOpen,\n    isThread = _ref.isThread,\n    noActions = _ref.noActions,\n    className = _ref.className,\n    unread = _ref.unread,\n    onEntryInView = _ref.onEntryInView,\n    isPreview = _ref.isPreview,\n    isFirstMessage = _ref.isFirstMessage;\n  var _useContext = useContext(UserContext),\n    user = _useContext.user,\n    getMessageQueue = _useContext.getMessageQueue;\n  var _useState = useState(false),\n    isEditing = _useState[0],\n    setEditing = _useState[1];\n  var _useState2 = useState(false),\n    showActions = _useState2[0],\n    setShowActions = _useState2[1];\n  var toggleEditing = function toggleEditing() {\n    return setEditing(!isEditing);\n  };\n  var editMessage = function editMessage(editedValue) {\n    if (message.body !== editedValue) {\n      onEdit(editedValue, message.id);\n    }\n    toggleEditing();\n  };\n  var _useInView = useInView({\n      triggerOnce: true,\n      threshold: 0\n    }),\n    _useInView2 = _slicedToArray(_useInView, 2),\n    intersectionRef = _useInView2[0],\n    inView = _useInView2[1];\n  useEffect(function () {\n    if (unread && inView) {\n      onEntryInView(message);\n    }\n  }, [inView]);\n  var setShow = function setShow(value) {\n    setShowActions(value);\n  };\n  var showReactions = !isEditing && message.reactions && message.reactions.length > 0;\n  var showReplies = !isThread && !isPreview && message.children.length > 0;\n  var canShowAction = !noActions && !isEditing && user;\n  var isDeleted = false;\n  if (user) {\n    var deletedMessages = getMessageQueue();\n    if (deletedMessages.filter(function (e) {\n      return e === message.id;\n    }).length > 0) isDeleted = true;\n  }\n  return __jsx(S.MessageContainer, {\n    show: canShowAction && showActions,\n    onMouseLeave: function onMouseLeave() {\n      return setShowActions(false);\n    },\n    onMouseEnter: function onMouseEnter() {\n      return setShowActions(true);\n    },\n    onMouseOver: function onMouseOver() {\n      return setShowActions(true);\n    },\n    onFocus: function onFocus() {\n      return setShowActions(true);\n    },\n    editing: isEditing,\n    unread: unread,\n    className: className || '',\n    ref: forwardedRef,\n    isFirstMessage: isFirstMessage,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }\n  }, __jsx(MessageWrapper, {\n    message: message,\n    isEditing: isEditing,\n    isChild: isChild,\n    isDeleted: isDeleted,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 9\n    }\n  }, isEditing ? __jsx(Editor, {\n    initialValue: transformMessage(message.body),\n    onCancel: toggleEditing,\n    onSubmit: editMessage,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }\n  }) : __jsx(S.Body, {\n    child: isChild,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 13\n    }\n  }, transformMessage(message.body)), showReactions && __jsx(Reactions, {\n    reactions: message.reactions,\n    messageId: message.id,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 29\n    }\n  }), showReplies && __jsx(Replies, {\n    reply: message.children,\n    onClick: function onClick() {\n      return onThreadOpen(message.id);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }\n  })), canShowAction && showActions && __jsx(Actions, {\n    setShow: setShow,\n    isThread: isThread,\n    onEdit: toggleEditing,\n    onReply: function onReply() {\n      return onThreadOpen(message.id);\n    },\n    message: message,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 11\n    }\n  }), __jsx(\"div\", {\n    ref: intersectionRef,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 9\n    }\n  }));\n});\nexport default Message;","map":{"version":3,"names":["useState","useEffect","useContext","forwardRef","UserContext","useInView","transformMessage","Actions","Reactions","Replies","Editor","MessageWrapper","S","Message","forwardedRef","message","isChild","onEdit","onThreadOpen","isThread","noActions","className","unread","onEntryInView","isPreview","isFirstMessage","user","getMessageQueue","isEditing","setEditing","showActions","setShowActions","toggleEditing","editMessage","editedValue","body","id","triggerOnce","threshold","intersectionRef","inView","setShow","value","showReactions","reactions","length","showReplies","children","canShowAction","isDeleted","deletedMessages","filter","e"],"sources":["/Volumes/MacData/work/ciscord-frontend.git/components/Chat/Message/Message.js"],"sourcesContent":["import { useState, useEffect, useContext, forwardRef } from 'react';\nimport { UserContext } from 'context/UserContext';\nimport { useInView } from 'react-intersection-observer';\nimport { transformMessage } from 'utils/helper';\n\nimport Actions from './Actions';\nimport Reactions from './Reactions';\nimport Replies from './Replies';\nimport Editor from './Editor';\n\nimport MessageWrapper from './_MessageWrapper';\n\nimport * as S from './Message.styled';\n\nconst Message = forwardRef(\n  (\n    {\n      message,\n      isChild,\n      onEdit,\n      onThreadOpen,\n      isThread,\n      noActions,\n      className,\n      unread,\n      onEntryInView,\n      isPreview,\n      isFirstMessage,\n    },\n    forwardedRef\n  ) => {\n    const { user, getMessageQueue } = useContext(UserContext);\n    const [isEditing, setEditing] = useState(false);\n    const [showActions, setShowActions] = useState(false);\n\n    const toggleEditing = () => setEditing(!isEditing);\n\n    const editMessage = editedValue => {\n      if (message.body !== editedValue) {\n        onEdit(editedValue, message.id);\n      }\n      toggleEditing();\n    };\n\n    const [intersectionRef, inView] = useInView({\n      triggerOnce: true,\n      threshold: 0,\n    });\n\n    useEffect(() => {\n      if (unread && inView) {\n        onEntryInView(message);\n      }\n    }, [inView]);\n\n    const setShow = value => {\n      setShowActions(value);\n    };\n\n    const showReactions = !isEditing && message.reactions && message.reactions.length > 0;\n    const showReplies = !isThread && !isPreview && message.children.length > 0;\n\n    const canShowAction = !noActions && !isEditing && user;\n    let isDeleted = false;\n    if (user) {\n      const deletedMessages = getMessageQueue();\n      if (deletedMessages.filter(e => e === message.id).length > 0) isDeleted = true;\n    }\n    return (\n      <S.MessageContainer\n        show={canShowAction && showActions}\n        onMouseLeave={() => setShowActions(false)}\n        onMouseEnter={() => setShowActions(true)}\n        onMouseOver={() => setShowActions(true)}\n        onFocus={() => setShowActions(true)}\n        editing={isEditing}\n        unread={unread}\n        className={className || ''}\n        ref={forwardedRef}\n        isFirstMessage={isFirstMessage}\n      >\n        <MessageWrapper\n          message={message}\n          isEditing={isEditing}\n          isChild={isChild}\n          isDeleted={isDeleted}\n        >\n          {isEditing ? (\n            <Editor\n              initialValue={transformMessage(message.body)}\n              onCancel={toggleEditing}\n              onSubmit={editMessage}\n            />\n          ) : (\n            <S.Body child={isChild}>{transformMessage(message.body)}</S.Body>\n          )}\n          {showReactions && <Reactions reactions={message.reactions} messageId={message.id} />}\n          {showReplies && (\n            <Replies reply={message.children} onClick={() => onThreadOpen(message.id)} />\n          )}\n        </MessageWrapper>\n        {canShowAction && showActions && (\n          <Actions\n            setShow={setShow}\n            isThread={isThread}\n            onEdit={toggleEditing}\n            onReply={() => onThreadOpen(message.id)}\n            message={message}\n          />\n        )}\n        <div ref={intersectionRef} />\n      </S.MessageContainer>\n    );\n  }\n);\n\nexport default Message;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}