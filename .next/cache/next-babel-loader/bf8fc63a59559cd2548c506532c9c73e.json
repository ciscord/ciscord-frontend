{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport { useRef, useCallback, useContext } from 'react';\nimport { useWindowDimensions } from 'hooks';\nimport { UserContext } from 'context';\nimport { useRouter } from 'next/router';\nimport { useMutation } from '@apollo/client';\nimport { toast } from 'react-toastify';\nimport { PortalWithState } from 'react-portal';\nimport { canDeleteMessage, canEditMessage } from 'utils/permission';\nimport Tooltip from 'components/UI/Tooltip';\nimport Flag from 'components/UI/Flag';\nimport moreIcon from 'public/icons/more.svg';\nimport DirectMenuItem from './Direct';\nimport { Action, TooltipWrapper } from '../MessageActions.styled';\nimport * as S from './More.styled';\nvar MorePopup = function MorePopup(_ref) {\n  var close = _ref.close,\n    getPosition = _ref.getPosition,\n    user = _ref.user,\n    messageAuthor = _ref.messageAuthor,\n    onShare = _ref.onShare,\n    onEdit = _ref.onEdit,\n    onDelete = _ref.onDelete;\n  return __jsx(S.Overlay, {\n    onClick: close\n  }, __jsx(S.MoreMenu, {\n    position: getPosition(),\n    className: \"modal-more\"\n  }, __jsx(DirectMenuItem, {\n    messageAuthor: messageAuthor\n  }), __jsx(S.MoreMenuItem, {\n    onClick: onShare\n  }, \"Copy link\"), canEditMessage(user, messageAuthor) && __jsx(S.MoreMenuItem, {\n    onClick: onEdit\n  }, \"Edit\"), canDeleteMessage(user, messageAuthor) && __jsx(S.MoreMenuItem, {\n    onClick: onDelete\n  }, \"Delete\")));\n};\nexport default (function (_ref2) {\n  var onEdit = _ref2.onEdit,\n    messageId = _ref2.messageId,\n    messageAuthor = _ref2.messageAuthor,\n    setShow = _ref2.setShow;\n  var ref = useRef(null);\n  var windowSize = useWindowDimensions();\n  var _useContext = useContext(UserContext),\n    user = _useContext.user,\n    addMessageQueue = _useContext.addMessageQueue,\n    removeMessageQueue = _useContext.removeMessageQueue;\n  var _useRouter = useRouter(),\n    _useRouter$query = _useRouter.query,\n    communityUrl = _useRouter$query.community,\n    channelUrl = _useRouter$query.channel,\n    companyUrl = _useRouter$query.company;\n  var onShare = function onShare() {\n    var threadId = null;\n    var link = \"\".concat(process.env.FRONTEND_URL, \"/\").concat(companyUrl, \"/\").concat(communityUrl, \"/\").concat(channelUrl, \"?linkMessageId=\").concat(messageId).concat(threadId ? \"&threadId=\".concat(threadId) : '');\n    navigator.clipboard.writeText(link);\n  };\n  var onDelete = function onDelete() {\n    toast(__jsx(Flag, {\n      label: \"Message deleted\",\n      action: {\n        label: 'Undo',\n        onClick: function onClick() {\n          return removeMessageQueue(messageId);\n        }\n      }\n    }), {\n      position: toast.POSITION.BOTTOM_RIGHT,\n      onOpen: function onOpen() {\n        return addMessageQueue(messageId);\n      }\n    });\n  };\n  var getPosition = useCallback(function () {\n    var _ref$current$getBound = ref.current.getBoundingClientRect(),\n      y = _ref$current$getBound.y,\n      x = _ref$current$getBound.x;\n    if (windowSize.height < y + 200) {\n      return {\n        x: windowSize.width - x,\n        y: windowSize.height - y + 10,\n        position: 't'\n      };\n    }\n    return {\n      x: windowSize.width - x,\n      y: y + 35,\n      position: 'b'\n    };\n  }, [user]);\n  if (!user) return __jsx(\"div\", null);\n  return __jsx(PortalWithState, {\n    closeOnOutsideClick: true,\n    closeOnEsc: true,\n    node: document && document.getElementById('ReactModalPortal')\n  }, function (_ref3) {\n    var openPortal = _ref3.openPortal,\n      closePortal = _ref3.closePortal,\n      portal = _ref3.portal;\n    return __jsx(React.Fragment, null, __jsx(Action, {\n      onClick: openPortal\n    }, __jsx(S.MoreIcon, {\n      className: \"more-icon\",\n      ref: ref\n    }, __jsx(\"use\", {\n      xlinkHref: \"\".concat(moreIcon, \"#icon-more\")\n    })), __jsx(TooltipWrapper, null, __jsx(Tooltip, null, \"More\"))), portal(__jsx(MorePopup, {\n      close: function close() {\n        closePortal();\n        setShow(false);\n      },\n      getPosition: getPosition,\n      user: user,\n      messageAuthor: messageAuthor,\n      onShare: onShare,\n      onEdit: onEdit,\n      onDelete: onDelete\n    })));\n  });\n});","map":{"version":3,"names":["useRef","useCallback","useContext","useWindowDimensions","UserContext","useRouter","useMutation","toast","PortalWithState","canDeleteMessage","canEditMessage","Tooltip","Flag","moreIcon","DirectMenuItem","Action","TooltipWrapper","S","MorePopup","close","getPosition","user","messageAuthor","onShare","onEdit","onDelete","messageId","setShow","ref","windowSize","addMessageQueue","removeMessageQueue","query","communityUrl","community","channelUrl","channel","companyUrl","company","threadId","link","process","env","FRONTEND_URL","navigator","clipboard","writeText","label","onClick","position","POSITION","BOTTOM_RIGHT","onOpen","current","getBoundingClientRect","y","x","height","width","document","getElementById","openPortal","closePortal","portal"],"sources":["/Volumes/MacData/work/ciscord-frontend.git/components/Chat/Message/Actions/More/More.js"],"sourcesContent":["import { useRef, useCallback, useContext } from 'react';\nimport { useWindowDimensions } from 'hooks';\nimport { UserContext } from 'context';\nimport { useRouter } from 'next/router';\nimport { useMutation } from '@apollo/client';\nimport { toast } from 'react-toastify';\nimport { PortalWithState } from 'react-portal';\n\nimport { canDeleteMessage, canEditMessage } from 'utils/permission';\n\nimport Tooltip from 'components/UI/Tooltip';\nimport Flag from 'components/UI/Flag';\nimport moreIcon from 'public/icons/more.svg';\n\nimport DirectMenuItem from './Direct';\nimport { Action, TooltipWrapper } from '../MessageActions.styled';\nimport * as S from './More.styled';\n\nconst MorePopup = ({ close, getPosition, user, messageAuthor, onShare, onEdit, onDelete }) => {\n  return (\n    <S.Overlay onClick={close}>\n      <S.MoreMenu position={getPosition()} className=\"modal-more\">\n        <DirectMenuItem messageAuthor={messageAuthor} />\n        <S.MoreMenuItem onClick={onShare}>Copy link</S.MoreMenuItem>\n        {canEditMessage(user, messageAuthor) && (\n          <S.MoreMenuItem onClick={onEdit}>Edit</S.MoreMenuItem>\n        )}\n        {canDeleteMessage(user, messageAuthor) && (\n          <S.MoreMenuItem onClick={onDelete}>Delete</S.MoreMenuItem>\n        )}\n      </S.MoreMenu>\n    </S.Overlay>\n  );\n};\n\nexport default ({ onEdit, messageId, messageAuthor, setShow }) => {\n  const ref = useRef(null);\n  const windowSize = useWindowDimensions();\n\n  const { user, addMessageQueue, removeMessageQueue } = useContext(UserContext);\n\n  const {\n    query: { community: communityUrl, channel: channelUrl, company: companyUrl },\n  } = useRouter();\n\n  const onShare = () => {\n    const threadId = null;\n\n    const link = `${\n      process.env.FRONTEND_URL\n    }/${companyUrl}/${communityUrl}/${channelUrl}?linkMessageId=${messageId}${\n      threadId ? `&threadId=${threadId}` : ''\n    }`;\n\n    navigator.clipboard.writeText(link);\n  };\n\n  const onDelete = () => {\n    toast(\n      <Flag\n        label=\"Message deleted\"\n        action={{\n          label: 'Undo',\n          onClick: () => removeMessageQueue(messageId),\n        }}\n      />,\n      {\n        position: toast.POSITION.BOTTOM_RIGHT,\n        onOpen: () => addMessageQueue(messageId),\n      }\n    );\n  };\n\n  const getPosition = useCallback(() => {\n    const { y, x } = ref.current.getBoundingClientRect();\n\n    if (windowSize.height < y + 200) {\n      return { x: windowSize.width - x, y: windowSize.height - y + 10, position: 't' };\n    }\n    return { x: windowSize.width - x, y: y + 35, position: 'b' };\n  }, [user]);\n\n  if (!user) return <div />;\n\n  return (\n    <PortalWithState\n      closeOnOutsideClick\n      closeOnEsc\n      node={document && document.getElementById('ReactModalPortal')}\n    >\n      {({ openPortal, closePortal, portal }) => (\n        <>\n          <Action onClick={openPortal}>\n            <S.MoreIcon className=\"more-icon\" ref={ref}>\n              <use xlinkHref={`${moreIcon}#icon-more`} />\n            </S.MoreIcon>\n            <TooltipWrapper>\n              <Tooltip>More</Tooltip>\n            </TooltipWrapper>\n          </Action>\n          {portal(\n            <MorePopup\n              close={() => {\n                closePortal();\n                setShow(false);\n              }}\n              getPosition={getPosition}\n              user={user}\n              messageAuthor={messageAuthor}\n              onShare={onShare}\n              onEdit={onEdit}\n              onDelete={onDelete}\n            />\n          )}\n        </>\n      )}\n    </PortalWithState>\n  );\n};\n"],"mappings":";;AAAA,SAASA,MAAM,EAAEC,WAAW,EAAEC,UAAU,QAAQ,OAAO;AACvD,SAASC,mBAAmB,QAAQ,OAAO;AAC3C,SAASC,WAAW,QAAQ,SAAS;AACrC,SAASC,SAAS,QAAQ,aAAa;AACvC,SAASC,WAAW,QAAQ,gBAAgB;AAC5C,SAASC,KAAK,QAAQ,gBAAgB;AACtC,SAASC,eAAe,QAAQ,cAAc;AAE9C,SAASC,gBAAgB,EAAEC,cAAc,QAAQ,kBAAkB;AAEnE,OAAOC,OAAO,MAAM,uBAAuB;AAC3C,OAAOC,IAAI,MAAM,oBAAoB;AACrC,OAAOC,QAAQ,MAAM,uBAAuB;AAE5C,OAAOC,cAAc,MAAM,UAAU;AACrC,SAASC,MAAM,EAAEC,cAAc,QAAQ,0BAA0B;AACjE,OAAO,KAAKC,CAAC,MAAM,eAAe;AAElC,IAAMC,SAAS,GAAG,SAAZA,SAAS,OAA+E;EAAA,IAAzEC,KAAK,QAALA,KAAK;IAAEC,WAAW,QAAXA,WAAW;IAAEC,IAAI,QAAJA,IAAI;IAAEC,aAAa,QAAbA,aAAa;IAAEC,OAAO,QAAPA,OAAO;IAAEC,MAAM,QAANA,MAAM;IAAEC,QAAQ,QAARA,QAAQ;EACrF,OACE,MAAC,CAAC,CAAC,OAAO;IAAC,OAAO,EAAEN;EAAM,GACxB,MAAC,CAAC,CAAC,QAAQ;IAAC,QAAQ,EAAEC,WAAW,EAAG;IAAC,SAAS,EAAC;EAAY,GACzD,MAAC,cAAc;IAAC,aAAa,EAAEE;EAAc,EAAG,EAChD,MAAC,CAAC,CAAC,YAAY;IAAC,OAAO,EAAEC;EAAQ,eAA2B,EAC3Db,cAAc,CAACW,IAAI,EAAEC,aAAa,CAAC,IAClC,MAAC,CAAC,CAAC,YAAY;IAAC,OAAO,EAAEE;EAAO,UACjC,EACAf,gBAAgB,CAACY,IAAI,EAAEC,aAAa,CAAC,IACpC,MAAC,CAAC,CAAC,YAAY;IAAC,OAAO,EAAEG;EAAS,YACnC,CACU,CACH;AAEhB,CAAC;AAED,gBAAe,iBAAmD;EAAA,IAAhDD,MAAM,SAANA,MAAM;IAAEE,SAAS,SAATA,SAAS;IAAEJ,aAAa,SAAbA,aAAa;IAAEK,OAAO,SAAPA,OAAO;EACzD,IAAMC,GAAG,GAAG5B,MAAM,CAAC,IAAI,CAAC;EACxB,IAAM6B,UAAU,GAAG1B,mBAAmB,EAAE;EAExC,kBAAsDD,UAAU,CAACE,WAAW,CAAC;IAArEiB,IAAI,eAAJA,IAAI;IAAES,eAAe,eAAfA,eAAe;IAAEC,kBAAkB,eAAlBA,kBAAkB;EAEjD,iBAEI1B,SAAS,EAAE;IAAA,8BADb2B,KAAK;IAAeC,YAAY,oBAAvBC,SAAS;IAAyBC,UAAU,oBAAnBC,OAAO;IAAuBC,UAAU,oBAAnBC,OAAO;EAGhE,IAAMf,OAAO,GAAG,SAAVA,OAAO,GAAS;IACpB,IAAMgB,QAAQ,GAAG,IAAI;IAErB,IAAMC,IAAI,aACRC,OAAO,CAACC,GAAG,CAACC,YAAY,cACtBN,UAAU,cAAIJ,YAAY,cAAIE,UAAU,4BAAkBT,SAAS,SACrEa,QAAQ,uBAAgBA,QAAQ,IAAK,EAAE,CACvC;IAEFK,SAAS,CAACC,SAAS,CAACC,SAAS,CAACN,IAAI,CAAC;EACrC,CAAC;EAED,IAAMf,QAAQ,GAAG,SAAXA,QAAQ,GAAS;IACrBlB,KAAK,CACH,MAAC,IAAI;MACH,KAAK,EAAC,iBAAiB;MACvB,MAAM,EAAE;QACNwC,KAAK,EAAE,MAAM;QACbC,OAAO,EAAE;UAAA,OAAMjB,kBAAkB,CAACL,SAAS,CAAC;QAAA;MAC9C;IAAE,EACF,EACF;MACEuB,QAAQ,EAAE1C,KAAK,CAAC2C,QAAQ,CAACC,YAAY;MACrCC,MAAM,EAAE;QAAA,OAAMtB,eAAe,CAACJ,SAAS,CAAC;MAAA;IAC1C,CAAC,CACF;EACH,CAAC;EAED,IAAMN,WAAW,GAAGnB,WAAW,CAAC,YAAM;IACpC,4BAAiB2B,GAAG,CAACyB,OAAO,CAACC,qBAAqB,EAAE;MAA5CC,CAAC,yBAADA,CAAC;MAAEC,CAAC,yBAADA,CAAC;IAEZ,IAAI3B,UAAU,CAAC4B,MAAM,GAAGF,CAAC,GAAG,GAAG,EAAE;MAC/B,OAAO;QAAEC,CAAC,EAAE3B,UAAU,CAAC6B,KAAK,GAAGF,CAAC;QAAED,CAAC,EAAE1B,UAAU,CAAC4B,MAAM,GAAGF,CAAC,GAAG,EAAE;QAAEN,QAAQ,EAAE;MAAI,CAAC;IAClF;IACA,OAAO;MAAEO,CAAC,EAAE3B,UAAU,CAAC6B,KAAK,GAAGF,CAAC;MAAED,CAAC,EAAEA,CAAC,GAAG,EAAE;MAAEN,QAAQ,EAAE;IAAI,CAAC;EAC9D,CAAC,EAAE,CAAC5B,IAAI,CAAC,CAAC;EAEV,IAAI,CAACA,IAAI,EAAE,OAAO,kBAAO;EAEzB,OACE,MAAC,eAAe;IACd,mBAAmB;IACnB,UAAU;IACV,IAAI,EAAEsC,QAAQ,IAAIA,QAAQ,CAACC,cAAc,CAAC,kBAAkB;EAAE,GAE7D;IAAA,IAAGC,UAAU,SAAVA,UAAU;MAAEC,WAAW,SAAXA,WAAW;MAAEC,MAAM,SAANA,MAAM;IAAA,OACjC,4BACE,MAAC,MAAM;MAAC,OAAO,EAAEF;IAAW,GAC1B,MAAC,CAAC,CAAC,QAAQ;MAAC,SAAS,EAAC,WAAW;MAAC,GAAG,EAAEjC;IAAI,GACzC;MAAK,SAAS,YAAKf,QAAQ;IAAa,EAAG,CAChC,EACb,MAAC,cAAc,QACb,MAAC,OAAO,eAAe,CACR,CACV,EACRkD,MAAM,CACL,MAAC,SAAS;MACR,KAAK,EAAE,iBAAM;QACXD,WAAW,EAAE;QACbnC,OAAO,CAAC,KAAK,CAAC;MAChB,CAAE;MACF,WAAW,EAAEP,WAAY;MACzB,IAAI,EAAEC,IAAK;MACX,aAAa,EAAEC,aAAc;MAC7B,OAAO,EAAEC,OAAQ;MACjB,MAAM,EAAEC,MAAO;MACf,QAAQ,EAAEC;IAAS,EACnB,CACH,CACA;EAAA,CACJ,CACe;AAEtB,CAAC"},"metadata":{},"sourceType":"module"}