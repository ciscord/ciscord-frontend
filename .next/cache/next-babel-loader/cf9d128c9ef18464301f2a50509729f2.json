{"ast":null,"code":"var _jsxFileName = \"/Volumes/MacData/work/ciscord-frontend.git/components/Chat/Message/Actions/More/More.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useRef, useCallback, useContext } from 'react';\nimport { useWindowDimensions } from 'hooks';\nimport { UserContext } from 'context';\nimport { useRouter } from 'next/router';\nimport { useMutation } from '@apollo/client';\nimport { toast } from 'react-toastify';\nimport { PortalWithState } from 'react-portal';\nimport { canDeleteMessage, canEditMessage } from 'utils/permission';\nimport Tooltip from 'components/UI/Tooltip';\nimport Flag from 'components/UI/Flag';\nimport moreIcon from 'public/icons/more.svg';\nimport DirectMenuItem from './Direct';\nimport { Action, TooltipWrapper } from '../MessageActions.styled';\nimport * as S from './More.styled';\nconst MorePopup = ({\n  close,\n  getPosition,\n  user,\n  messageAuthor,\n  onShare,\n  onEdit,\n  onDelete\n}) => {\n  return __jsx(S.Overlay, {\n    onClick: close,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21,\n      columnNumber: 5\n    }\n  }, __jsx(S.MoreMenu, {\n    position: getPosition(),\n    className: \"modal-more\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 22,\n      columnNumber: 7\n    }\n  }, __jsx(DirectMenuItem, {\n    messageAuthor: messageAuthor,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23,\n      columnNumber: 9\n    }\n  }), __jsx(S.MoreMenuItem, {\n    onClick: onShare,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24,\n      columnNumber: 9\n    }\n  }, \"Copy link\"), canEditMessage(user, messageAuthor) && __jsx(S.MoreMenuItem, {\n    onClick: onEdit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 11\n    }\n  }, \"Edit\"), canDeleteMessage(user, messageAuthor) && __jsx(S.MoreMenuItem, {\n    onClick: onDelete,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 11\n    }\n  }, \"Delete\")));\n};\nexport default (({\n  onEdit,\n  messageId,\n  messageAuthor,\n  setShow\n}) => {\n  const ref = useRef(null);\n  const windowSize = useWindowDimensions();\n  const {\n    user,\n    addMessageQueue,\n    removeMessageQueue\n  } = useContext(UserContext);\n  const {\n    query: {\n      community: communityUrl,\n      channel: channelUrl,\n      company: companyUrl\n    }\n  } = useRouter();\n  const onShare = () => {\n    const threadId = null;\n    const link = `${process.env.FRONTEND_URL}/${companyUrl}/${communityUrl}/${channelUrl}?linkMessageId=${messageId}${threadId ? `&threadId=${threadId}` : ''}`;\n    navigator.clipboard.writeText(link);\n  };\n  const onDelete = () => {\n    toast(__jsx(Flag, {\n      label: \"Message deleted\",\n      action: {\n        label: 'Undo',\n        onClick: () => removeMessageQueue(messageId)\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 7\n      }\n    }), {\n      position: toast.POSITION.BOTTOM_RIGHT,\n      onOpen: () => addMessageQueue(messageId)\n    });\n  };\n  const getPosition = useCallback(() => {\n    const {\n      y,\n      x\n    } = ref.current.getBoundingClientRect();\n    if (windowSize.height < y + 200) {\n      return {\n        x: windowSize.width - x,\n        y: windowSize.height - y + 10,\n        position: 't'\n      };\n    }\n    return {\n      x: windowSize.width - x,\n      y: y + 35,\n      position: 'b'\n    };\n  }, [user]);\n  if (!user) return __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 21\n    }\n  });\n  return __jsx(PortalWithState, {\n    closeOnOutsideClick: true,\n    closeOnEsc: true,\n    node: document && document.getElementById('ReactModalPortal'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 5\n    }\n  }, ({\n    openPortal,\n    closePortal,\n    portal\n  }) => __jsx(React.Fragment, null, __jsx(Action, {\n    onClick: openPortal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 11\n    }\n  }, __jsx(S.MoreIcon, {\n    className: \"more-icon\",\n    ref: ref,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }, __jsx(\"use\", {\n    xlinkHref: `${moreIcon}#icon-more`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 15\n    }\n  })), __jsx(TooltipWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }\n  }, __jsx(Tooltip, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 15\n    }\n  }, \"More\"))), portal(__jsx(MorePopup, {\n    close: () => {\n      closePortal();\n      setShow(false);\n    },\n    getPosition: getPosition,\n    user: user,\n    messageAuthor: messageAuthor,\n    onShare: onShare,\n    onEdit: onEdit,\n    onDelete: onDelete,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 13\n    }\n  }))));\n});","map":{"version":3,"names":["useRef","useCallback","useContext","useWindowDimensions","UserContext","useRouter","useMutation","toast","PortalWithState","canDeleteMessage","canEditMessage","Tooltip","Flag","moreIcon","DirectMenuItem","Action","TooltipWrapper","S","MorePopup","close","getPosition","user","messageAuthor","onShare","onEdit","onDelete","messageId","setShow","ref","windowSize","addMessageQueue","removeMessageQueue","query","community","communityUrl","channel","channelUrl","company","companyUrl","threadId","link","process","env","FRONTEND_URL","navigator","clipboard","writeText","label","onClick","position","POSITION","BOTTOM_RIGHT","onOpen","y","x","current","getBoundingClientRect","height","width","document","getElementById","openPortal","closePortal","portal"],"sources":["/Volumes/MacData/work/ciscord-frontend.git/components/Chat/Message/Actions/More/More.js"],"sourcesContent":["import { useRef, useCallback, useContext } from 'react';\nimport { useWindowDimensions } from 'hooks';\nimport { UserContext } from 'context';\nimport { useRouter } from 'next/router';\nimport { useMutation } from '@apollo/client';\nimport { toast } from 'react-toastify';\nimport { PortalWithState } from 'react-portal';\n\nimport { canDeleteMessage, canEditMessage } from 'utils/permission';\n\nimport Tooltip from 'components/UI/Tooltip';\nimport Flag from 'components/UI/Flag';\nimport moreIcon from 'public/icons/more.svg';\n\nimport DirectMenuItem from './Direct';\nimport { Action, TooltipWrapper } from '../MessageActions.styled';\nimport * as S from './More.styled';\n\nconst MorePopup = ({ close, getPosition, user, messageAuthor, onShare, onEdit, onDelete }) => {\n  return (\n    <S.Overlay onClick={close}>\n      <S.MoreMenu position={getPosition()} className=\"modal-more\">\n        <DirectMenuItem messageAuthor={messageAuthor} />\n        <S.MoreMenuItem onClick={onShare}>Copy link</S.MoreMenuItem>\n        {canEditMessage(user, messageAuthor) && (\n          <S.MoreMenuItem onClick={onEdit}>Edit</S.MoreMenuItem>\n        )}\n        {canDeleteMessage(user, messageAuthor) && (\n          <S.MoreMenuItem onClick={onDelete}>Delete</S.MoreMenuItem>\n        )}\n      </S.MoreMenu>\n    </S.Overlay>\n  );\n};\n\nexport default ({ onEdit, messageId, messageAuthor, setShow }) => {\n  const ref = useRef(null);\n  const windowSize = useWindowDimensions();\n\n  const { user, addMessageQueue, removeMessageQueue } = useContext(UserContext);\n\n  const {\n    query: { community: communityUrl, channel: channelUrl, company: companyUrl },\n  } = useRouter();\n\n  const onShare = () => {\n    const threadId = null;\n\n    const link = `${\n      process.env.FRONTEND_URL\n    }/${companyUrl}/${communityUrl}/${channelUrl}?linkMessageId=${messageId}${\n      threadId ? `&threadId=${threadId}` : ''\n    }`;\n\n    navigator.clipboard.writeText(link);\n  };\n\n  const onDelete = () => {\n    toast(\n      <Flag\n        label=\"Message deleted\"\n        action={{\n          label: 'Undo',\n          onClick: () => removeMessageQueue(messageId),\n        }}\n      />,\n      {\n        position: toast.POSITION.BOTTOM_RIGHT,\n        onOpen: () => addMessageQueue(messageId),\n      }\n    );\n  };\n\n  const getPosition = useCallback(() => {\n    const { y, x } = ref.current.getBoundingClientRect();\n\n    if (windowSize.height < y + 200) {\n      return { x: windowSize.width - x, y: windowSize.height - y + 10, position: 't' };\n    }\n    return { x: windowSize.width - x, y: y + 35, position: 'b' };\n  }, [user]);\n\n  if (!user) return <div />;\n\n  return (\n    <PortalWithState\n      closeOnOutsideClick\n      closeOnEsc\n      node={document && document.getElementById('ReactModalPortal')}\n    >\n      {({ openPortal, closePortal, portal }) => (\n        <>\n          <Action onClick={openPortal}>\n            <S.MoreIcon className=\"more-icon\" ref={ref}>\n              <use xlinkHref={`${moreIcon}#icon-more`} />\n            </S.MoreIcon>\n            <TooltipWrapper>\n              <Tooltip>More</Tooltip>\n            </TooltipWrapper>\n          </Action>\n          {portal(\n            <MorePopup\n              close={() => {\n                closePortal();\n                setShow(false);\n              }}\n              getPosition={getPosition}\n              user={user}\n              messageAuthor={messageAuthor}\n              onShare={onShare}\n              onEdit={onEdit}\n              onDelete={onDelete}\n            />\n          )}\n        </>\n      )}\n    </PortalWithState>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}